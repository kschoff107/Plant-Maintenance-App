{% extends "base.html" %}

{% block title %}Create Schedule - Plant Maintenance{% endblock %}

{% block content %}
<div class="module-container">
    <div class="module-header">
        <a href="{{ url_for('maintenance_schedules.index') }}" class="btn btn-back">
            &#8592; Back to Maintenance Schedule
        </a>
    </div>

    <div class="form-container" style="max-width: 700px;">
        <div class="form-header">
            <span style="font-size: 2.5rem;">&#10133;</span>
            <h1>Create Maintenance Schedule</h1>
            <p class="form-subtitle">Define a new preventive maintenance schedule</p>
        </div>

        <form method="POST" class="data-form">
            <div class="form-group">
                <label for="name">Schedule Name *</label>
                <input type="text" id="name" name="name" required
                       placeholder="e.g., Monthly Oil Change - Pump 101">
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="2"
                          placeholder="Brief description of this maintenance schedule"></textarea>
            </div>

            <div class="form-group">
                <label for="equipment_id">Equipment *</label>
                <select id="equipment_id" name="equipment_id" required>
                    <option value="">-- Select Equipment --</option>
                    {% for equip in equipment_list %}
                    <option value="{{ equip.id }}">{{ equip.tag_number }} - {{ equip.description }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="schedule_type">Schedule Type *</label>
                    <select id="schedule_type" name="schedule_type" required onchange="toggleScheduleFields()">
                        {% for type in schedule_types %}
                        <option value="{{ type }}">{{ type|title }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority">
                        {% for p in priorities %}
                        <option value="{{ p }}" {% if p == 'Medium' %}selected{% endif %}>{{ p }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Time-based fields -->
            <div id="time_based_fields">
                <div class="form-row">
                    <div class="form-group">
                        <label for="frequency">Frequency *</label>
                        <select id="frequency" name="frequency">
                            <option value="">-- Select Frequency --</option>
                            {% for f in frequencies %}
                            <option value="{{ f }}">{{ f }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="initial_due_date">Initial Due Date</label>
                        <input type="date" id="initial_due_date" name="initial_due_date">
                        <small style="color: #7f8c8d; font-size: 0.8rem;">Leave blank to start from today</small>
                    </div>
                </div>
            </div>

            <!-- Meter-based fields -->
            <div id="meter_based_fields" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="meter_interval">Meter Interval *</label>
                        <input type="number" id="meter_interval" name="meter_interval" min="1"
                               placeholder="e.g., 500">
                    </div>

                    <div class="form-group">
                        <label for="meter_unit">Unit</label>
                        <select id="meter_unit" name="meter_unit">
                            <option value="">-- Select Unit --</option>
                            <option value="hours">Hours</option>
                            <option value="miles">Miles</option>
                            <option value="kilometers">Kilometers</option>
                            <option value="cycles">Cycles</option>
                            <option value="units">Units</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="current_meter">Current Meter Reading</label>
                    <input type="number" id="current_meter" name="current_meter" min="0"
                           placeholder="Enter current reading as baseline">
                </div>
            </div>

            <div class="form-group">
                <label for="estimated_duration">Estimated Duration (minutes)</label>
                <input type="number" id="estimated_duration" name="estimated_duration" min="1"
                       placeholder="e.g., 60">
            </div>

            <div class="form-group">
                <label for="instructions">Maintenance Instructions</label>
                <textarea id="instructions" name="instructions" rows="4"
                          placeholder="Step-by-step instructions for performing this maintenance"></textarea>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('maintenance_schedules.index') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Create Schedule</button>
            </div>
        </form>
    </div>
</div>

<script>
function toggleScheduleFields() {
    const scheduleType = document.getElementById('schedule_type').value;
    const timeFields = document.getElementById('time_based_fields');
    const meterFields = document.getElementById('meter_based_fields');

    if (scheduleType === 'meter-based') {
        timeFields.style.display = 'none';
        meterFields.style.display = 'block';
        document.getElementById('frequency').removeAttribute('required');
    } else {
        timeFields.style.display = 'block';
        meterFields.style.display = 'none';
        document.getElementById('frequency').setAttribute('required', 'required');
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', toggleScheduleFields);
</script>
{% endblock %}
