{% extends "base.html" %}

{% block title %}{{ schedule.name }} - Schedule Details{% endblock %}

{% block content %}
<div class="module-container">
    <div class="module-header">
        <a href="{{ url_for('maintenance_schedules.schedule_list') }}" class="btn btn-back">
            &#8592; Back to List
        </a>
    </div>

    <div class="detail-container">
        <div class="detail-header">
            <span style="font-size: 2.5rem;">&#128197;</span>
            <h1>{{ schedule.name }}</h1>
            <p class="detail-id">Maintenance Schedule</p>
        </div>

        <div class="detail-card">
            <div class="detail-row">
                <span class="detail-label">Schedule ID</span>
                <span class="detail-value">{{ schedule.schedule_id }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Name</span>
                <span class="detail-value">{{ schedule.name }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Description</span>
                <span class="detail-value">{{ schedule.description or 'Not specified' }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Equipment</span>
                <span class="detail-value">{{ schedule.equipment_tag }} - {{ schedule.equipment_desc }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Schedule Type</span>
                <span class="detail-value">{{ schedule.schedule_type|title }}</span>
            </div>

            {% if schedule.is_time_based() %}
            <div class="detail-row">
                <span class="detail-label">Frequency</span>
                <span class="detail-value">{{ schedule.frequency }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Next Due Date</span>
                <span class="detail-value">
                    {% if schedule.next_due_date %}
                        {{ schedule.next_due_date }}
                        {% if schedule.is_overdue() %}
                            <span style="color: #e53e3e; font-weight: bold;">(OVERDUE)</span>
                        {% elif schedule.is_due_today() %}
                            <span style="color: #ed8936; font-weight: bold;">(DUE TODAY)</span>
                        {% endif %}
                    {% else %}
                        Not calculated
                    {% endif %}
                </span>
            </div>
            {% else %}
            <div class="detail-row">
                <span class="detail-label">Meter Interval</span>
                <span class="detail-value">Every {{ schedule.meter_interval }} {{ schedule.meter_unit or 'units' }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Next Due Meter</span>
                <span class="detail-value">
                    {{ schedule.next_due_meter or 'Not set' }} {{ schedule.meter_unit or '' }}
                    {% if schedule.current_meter %}
                        (Current: {{ schedule.current_meter }})
                        {% if schedule.current_meter >= schedule.next_due_meter %}
                            <span style="color: #e53e3e; font-weight: bold;">(DUE)</span>
                        {% endif %}
                    {% endif %}
                </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Last Meter Reading</span>
                <span class="detail-value">{{ schedule.last_meter_reading or 'Not recorded' }} {{ schedule.meter_unit or '' }}</span>
            </div>
            {% endif %}

            <div class="detail-row">
                <span class="detail-label">Last Performed</span>
                <span class="detail-value">{{ schedule.last_performed_date or 'Never' }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Priority</span>
                <span class="detail-value">
                    <span class="priority-badge priority-{{ schedule.priority|lower }}">{{ schedule.priority }}</span>
                </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Estimated Duration</span>
                <span class="detail-value">
                    {% if schedule.estimated_duration %}
                        {{ schedule.estimated_duration }} minutes
                    {% else %}
                        Not specified
                    {% endif %}
                </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Status</span>
                <span class="detail-value">
                    <span class="status-badge {% if schedule.status == 'Active' %}status-active{% else %}status-inactive{% endif %}">
                        {{ schedule.status }}
                    </span>
                </span>
            </div>

            {% if schedule.instructions %}
            <div class="detail-row" style="flex-direction: column; align-items: flex-start;">
                <span class="detail-label" style="margin-bottom: 0.5rem;">Instructions</span>
                <span class="detail-value" style="white-space: pre-wrap; background-color: #f7fafc; padding: 1rem; border-radius: 4px; width: 100%;">{{ schedule.instructions }}</span>
            </div>
            {% endif %}
        </div>

        <div class="detail-actions">
            <a href="{{ url_for('maintenance_schedules.change', schedule_id=schedule.id) }}" class="btn btn-warning">
                &#9998; Edit Schedule
            </a>
            {% if schedule.status == 'Active' %}
            <form method="POST" action="{{ url_for('maintenance_schedules.create_work_order', schedule_id=schedule.id) }}" style="display: inline;">
                <button type="submit" class="btn btn-primary">
                    &#128221; Create Work Order
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<style>
.status-active {
    background-color: #48bb78;
    color: white;
}
.status-inactive {
    background-color: #a0aec0;
    color: white;
}
</style>
{% endblock %}
